definitions:
  caches:
    pnpm: .pnpm-store

pipelines:
  branches:
    staging:
      - step:
          name: Build and test
          image: node:21.4.0
          deployment: staging
          script:
            - npm install -g pnpm
            - pnpm install
            - pnpm run build
            - pnpx wrangler pages deploy .svelte-kit/cloudflare --project-name=fs-site-2022-staging --branch staging
          caches:
            - pnpm
    production:
      - step:
          name: Build and test
          image: node:21.4.0
          script:
            - npm install -g pnpm
            - pnpm install
            - pnpm run build
            - pnpx svelte-sitemap --domain https://futureshirts.co --out-dir=.svelte-kit/cloudflare
            - pnpx wrangler pages deploy .svelte-kit/cloudflare --project-name=fs-site --branch=production
          caches:
            - pnpm
  custom:
    sanity:
      - parallel:
          steps:
            - step:
                name: Build and test staging
                branch: staging
                image: node:21.4.0
                script:
                  - npm install -g pnpm
                  - pnpm install
                  - pnpm run build
                  - pnpx wrangler pages deploy .svelte-kit/cloudflare --project-name=fs-site-2022-staging --branch=staging
            - step:
                name: Build and test
                branch: production
                image: node:21.4.0
                script:
                  - npm install -g pnpm
                  - pnpm install
                  - pnpm run build
                  - pnpx svelte-sitemap --domain https://futureshirts.co --out-dir=.svelte-kit/cloudflare
                  - pnpx wrangler pages deploy .svelte-kit/cloudflare --project-name=fs-site --branch=production
                caches:
                  - pnpm
